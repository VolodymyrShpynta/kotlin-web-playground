version: '3.8'

services:
  main-app:
    build:
      context: ./main-app
      dockerfile: Dockerfile
    image: main-app:latest
    container_name: main-app
    ports:
      - "9000:4207"
    environment:
      - WEB_PLAYGROUND_ENV=${WEB_PLAYGROUND_ENV:-prod}
      - WEB_PLAYGROUND_HTTP_PORT=${WEB_PLAYGROUND_HTTP_PORT:-4207}
      - WEB_PLAYGROUND_DB_USER=${WEB_PLAYGROUND_DB_USER}
      - WEB_PLAYGROUND_DB_PASSWORD=${WEB_PLAYGROUND_DB_PASSWORD}
      - WEB_PLAYGROUND_DB_URL=${WEB_PLAYGROUND_DB_URL}
      - WEB_PLAYGROUND_USE_SECURE_COOKIE=${WEB_PLAYGROUND_USE_SECURE_COOKIE:-true}
      - WEB_PLAYGROUND_COOKIE_ENCRYPTION_KEY=${WEB_PLAYGROUND_COOKIE_ENCRYPTION_KEY}
      - WEB_PLAYGROUND_COOKIE_SIGNING_KEY=${WEB_PLAYGROUND_COOKIE_SIGNING_KEY}
      - WEB_PLAYGROUND_CORS_ALLOWED_HOSTS=${WEB_PLAYGROUND_CORS_ALLOWED_HOSTS:-}
      - WEB_PLAYGROUND_CORS_ALLOWED_HTTPS_HOSTS=${WEB_PLAYGROUND_CORS_ALLOWED_HTTPS_HOSTS:-}
      - THIRD_PARTY_SERVICE_URL=${THIRD_PARTY_SERVICE_URL:-http://third-party-service:9876}
    depends_on:
      - third-party-service
    # Optional: mount volume for persistent database
    # volumes:
    #   - ./data:/app/build
    restart: unless-stopped

  catalog-service:
    build:
      context: ./catalog-service
      dockerfile: Dockerfile
    image: catalog-service:latest
    container_name: catalog-service
    ports:
      - "9001:9877"
    environment:
      - SERVER_PORT=${CATALOG_SERVICE_PORT:-9877}
      - THIRD_PARTY_SERVICE_URL=${THIRD_PARTY_SERVICE_URL:-http://third-party-service:9002}
    depends_on:
      - third-party-service
    restart: unless-stopped

  third-party-service:
    build:
      context: ./third-party-service
      dockerfile: Dockerfile
    image: third-party-service:latest
    container_name: third-party-service
    ports:
      - "9002:9876"
    environment:
      - THIRD_PARTY_SERVICE_PORT=${THIRD_PARTY_SERVICE_PORT:-9876}
    restart: unless-stopped
